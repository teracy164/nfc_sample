<html>
    <head>
        <script>
            const isSupportedNFC = () => {
                if ('NDEFReader' in window) {
                    return true;
                } else {
                    document.getElementById('notice').style.display = '';
                    return false;
                }
            }
            const readNFC = async () => {
                return new Promise(async (resolve, reject) => {
                    /*
                        参考：https://w3c.github.io/web-nfc/#feature-support
                    */
                    try {
                        const reader = new NDEFReader();
                        await reader.scan();

                        reader.onreading = event => {
                            const result = document.getElementById('result');
                            result.innerText += result.innerText +'¥n' + JSON.stringify(event);
                            console.log(event);
                            resolve(event);
                        }
                        reader.onerror = event => {
                            console.error(event);
                            reject(event);
                        }
                    } catch (err) {
                        console.error(err);
                        reject();
                    }
                });
            }
            const startNFC = () => {
                document.getElementById('btn').setAttribute('disabled', true);
                document.getElementById('result').innerText = 'Loading';
                readNFC().then(result => {
                    document.getElementById('result').innerText = JSON.stringify(result);
                    document.getElementById('btn').setAttribute('disabled');
                }).catch(err => {
                    document.getElementById('result').innerText = JSON.stringify(err);
                    document.getElementById('btn').removeAttribute('disabled');
                })
            };

            window.onload = () => {
                if (isSupportedNFC()) {
                    console.log('nfc supported.')
                    document.getElementById('btn').style.display='';
                } else {
                    console.log('nfc not supported.')
                    document.getElementById('btn').style.display='none';
                }                
            }
        </script>
    </head>
    <body>
        <div id="notice" style="display: none">
            以下にアクセスし、Enabledに設定してください<br>
            chrome://flags/#enable-experimental-web-platform-features
        </div>
        <div style="padding: 10px; text-align: center;">
            <button id="btn" onclick="startNFC()">start NFC</button>
        </div>
        <div id="result">

        </div>
    </body>
</html>
